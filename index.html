<!DOCTYPE html>
<html>
  <head>
    <title>PockerChatRoom</title>
    <script src="/socket.io/socket.io.js"></script>
    <link
      rel="stylesheet"
      href="https://fonts.googleapis.com/icon?family=Material+Icons"
    />
    <link
      rel="stylesheet"
      href="https://code.getmdl.io/1.3.0/material.indigo-pink.min.css"
    />
    <script defer src="https://code.getmdl.io/1.3.0/material.min.js"></script>
    <link
      rel="stylesheet"
      href="https://code.getmdl.io/1.3.0/material.indigo-teal.min.css"
    />
    <style>
      #messages {
        list-style-type: none;
        margin: 0;
        padding: 0;
      }

      #messages li {
        padding: 5px 10px;
        font-size: 25px;
      }

      #messages li:nth-child(odd) {
        background: #eee;
      }

      #messages {
        margin-bottom: 40px;
      }

      .frm {
        display: flex;
        margin-right: 2px;
        margin-left: 4px;
      }

      .description > * {
        font-size: 20px;
      }
    </style>
  </head>

  <body>
    <div class="description">
      <p>What you can do:</p>
      <ul>
        <li>send a normal message</li>
        <li>
          send a command, you need to put a ! in front of the command:
          <ul>
            <li>
              <pre>!create</pre>
              allows you to create a new match. The bot will give a code to send
              to your friend
            </li>
            <li>
              <pre>!join $code</pre>
              allows you to join a match. Only the owner can start a match.
            </li>
          </ul>
        </li>
      </ul>
    </div>
    <ul id="messages"></ul>
    <form id="myForm" action="" class="frm">
      <div class="mdl-textfield mdl-js-textfield">
        <input
          class="mdl-textfield__input"
          type="text"
          id="m"
          autocomplete="off"
        />
        <label class="mdl-textfield__label" for="sample1"
          >Write something...</label
        >
      </div>
      <button
        class="mdl-button mdl-js-button mdl-button--fab mdl-button--colored"
      >
        <i class="material-icons">send</i>
      </button>
    </form>
    <script>
      const CHAT_MESSAGE = 'chat-message'
      const GAME_MESSAGE = 'game-message'
      const CHAT_MESSAGE_SELF = 'chat-message-self'
      const PERSONAL_MESSAGE = 'personal-message'
      const ERROR_MESSAGE = 'error-message'
      const INIT_USER = 'init-user'
      const CMD = 'cmd'
      const GENERAL_ROOM = 'generalRoom'

      var socket = io()
      const name = window.prompt('Tell me your name')
      socket.emit(INIT_USER, name)

      const form = document.getElementById('myForm')
      form.addEventListener('submit', function (evt) {
        evt.preventDefault()
        const message = document.getElementById('m').value
        if (message.startsWith('!')) {
          socket.emit(CMD, message)
        } else {
          socket.emit(CHAT_MESSAGE, message)
        }
        document.getElementById('m').value = ''
        return false
      })
      const messagesDiv = document.getElementById('messages')
      socket.on(CHAT_MESSAGE, function (msg) {
        const li = document.createElement('li')
        li.textContent = msg
        messagesDiv.appendChild(li)
        window.scrollTo(0, document.body.scrollHeight)
      })
      socket.on(CHAT_MESSAGE_SELF, function (msg) {
        const li = document.createElement('li')
        li.textContent = `You said: ${msg}`
        messagesDiv.appendChild(li)
        window.scrollTo(0, document.body.scrollHeight)
      })
      socket.on(ERROR_MESSAGE, function (msg) {
        const li = document.createElement('li')
        li.innerHTML = `<span><i>only visible to you</i><br/></span><b>${msg}</b>`
        messagesDiv.appendChild(li)
        window.scrollTo(0, document.body.scrollHeight)
      })
      socket.on(GAME_MESSAGE, function (msg) {
        const li = document.createElement('li')
        li.innerHTML = `<i>${msg}</i>`
        messagesDiv.appendChild(li)
        window.scrollTo(0, document.body.scrollHeight)
      })
      socket.on(PERSONAL_MESSAGE, function (msg) {
        const li = document.createElement('li')
        li.innerHTML = `<span><i>only visible to you</i><br/></span>${msg}`
        messagesDiv.appendChild(li)
        window.scrollTo(0, document.body.scrollHeight)
      })
    </script>
  </body>
</html>
